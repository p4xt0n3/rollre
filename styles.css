/* ...existing styles... */
:root {
  --bg: #0b0d10;
  --panel: #0f1318;
  --line: #1f2630;
  --text: #eaf2ff;
  --muted: #8ea3b9;
  --accent: #23c4f8;
  --blue: #3da9fc;
  --purple: #9b5de5;
  --gold: #f4c430;
  --red: #ef233c;
  --black: #0a0a0a;
}
* { box-sizing: border-box; }
body {
  margin: 0; background: var(--bg); color: var(--text);
  font-family: "Noto Sans", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  display: grid; grid-template-columns: 320px 1fr; min-height: 100vh;
}
.sidebar {
  border-right: 1px solid var(--line); background: var(--panel); padding: 20px; display:flex; flex-direction:column; gap:20px;
}
.logo { font-weight: 800; letter-spacing: 0.2em; color: var(--accent); }
.coins .label { color: var(--muted); font-size: 12px; text-transform: uppercase; }
.coins .amount { font-size: 32px; font-weight: 800; margin-top: 4px; }
.controls .group { border-top: 1px solid var(--line); padding-top: 16px; margin-top: 4px; }
.group-label { color: var(--muted); font-size: 12px; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
.radio { display:flex; align-items:center; gap:10px; padding:8px 0; color: var(--text); }
.radio input { accent-color: var(--accent); }
.toggle {
  width: 100%; display:flex; align-items:center; justify-content:space-between;
  background: #121820; border: 1px solid var(--line); color: var(--text);
  padding: 10px 12px; border-radius: 10px; cursor: pointer; transition: transform .12s ease, border-color .2s ease, background .2s ease;
}
.toggle:hover { transform: translateY(-1px); border-color: #2e3642; }
.toggle.on { background: linear-gradient(180deg, #111a22, #0e1720); border-color: #2b7ab1; }
.t-label { font-weight: 600; }
.t-state { color: var(--muted); }
.main { position: relative; display:flex; flex-direction:column; }
.topbar { height: 72px; display:flex; align-items:center; justify-content:center; border-bottom:1px solid var(--line); }
.roll-btn {
  background: transparent; color: var(--text); border: 1px solid var(--accent);
  padding: 12px 28px; border-radius: 999px; font-weight: 700; letter-spacing: .08em;
  position: relative; overflow: hidden; transition: transform .12s ease, box-shadow .2s ease, border-color .2s ease;
}
.roll-btn::after {
  content:""; position:absolute; inset:0; background: radial-gradient(120% 120% at 50% -10%, rgba(35,196,248,.28), transparent 60%);
  pointer-events:none; mix-blend-mode: screen;
}
.roll-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(35,196,248,.18); border-color: #58d8ff; }
.stage { position: relative; flex:1; display:flex; align-items:center; justify-content:center; overflow:hidden; }
.fx-canvas { position:absolute; inset:0; width:100%; height:100%; }
.results {
  display:grid; gap:14px;
  /* layout reserves space for two rows when 10x; default center horizontal */
  grid-auto-flow: column;
  justify-content: center;
  width: min(1200px, 92%); padding: 20px;
}
/* make cards larger */
.card {
  width: 120px; height: 320px; padding: 12px; border-radius: 14px;
  display:flex; flex-direction:column; gap:6px; justify-content:space-between;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
  border: 2px solid rgba(255,255,255,0.03);
  backdrop-filter: blur(6px) saturate(120%);
  box-shadow: 0 6px 20px rgba(2,6,12,0.65), inset 0 1px 0 rgba(255,255,255,0.02);
  transition: box-shadow .18s ease, transform .12s ease;
  position: relative; overflow: visible;
}
.card:hover { box-shadow: 0 10px 30px rgba(2,6,12,0.7), inset 0 2px 6px rgba(255,255,255,0.02); }
.card .thumb { display:none; } 
.card .name { font-weight: 800; font-size: 13px; line-height: 1; letter-spacing: .02em; color: #fff; text-shadow: 0 1px 0 rgba(0,0,0,0.6); }
.card .tag { font-size: 9px; letter-spacing: .08em; color: rgba(234,242,255,0.75); text-transform: uppercase; }
.card .meta { display:flex; flex-direction:column; gap:2px; }
.card .media { overflow: hidden; align-items:center; justify-content:center; padding:8px 6px 10px 6px; }
/* ensure image stays inside card and doesn't overflow */
.card .media img { width: auto; height: 72%; max-height: 72%; object-fit: contain; object-position: center; display:block; margin: 0 auto; border-radius: 10px; box-shadow: 0 8px 20px rgba(8,12,20,0.6); border: 1px solid rgba(255,255,255,0.04); }
.card.character {
  background: linear-gradient(120deg, rgba(35,196,248,0.12), rgba(155,93,229,0.10), rgba(244,196,48,0.08));
  background-size: 300% 300%; animation: hueflow 6s linear infinite;
  border: 2px solid transparent;
}
@keyframes hueflow { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
/* Rarity borders */
.r-blue { box-shadow: 0 0 0 2px rgba(61,169,252,0.18) inset, 0 6px 18px rgba(61,169,252,0.06); border-color: rgba(61,169,252,0.9); }
.r-purple { box-shadow: 0 0 0 2px rgba(155,93,229,0.16) inset, 0 6px 18px rgba(155,93,229,0.05); border-color: rgba(155,93,229,0.9); }
.r-gold { box-shadow: 0 0 0 2px rgba(244,196,48,0.14) inset, 0 6px 18px rgba(244,196,48,0.06); border-color: rgba(244,196,48,0.95); }
.r-red { box-shadow: 0 0 0 2px rgba(239,35,60,0.14) inset, 0 6px 18px rgba(239,35,60,0.06); border-color: rgba(239,35,60,0.95); }
.r-black { box-shadow: 0 0 0 2px rgba(0,0,0,0.5) inset, 0 8px 26px rgba(0,0,0,0.6); border-color: rgba(0,0,0,0.98); }
/* subtle vignette ring behind cards for depth */
.card::before {
  content:""; position:absolute; inset:0; border-radius:12px;
  background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(255,255,255,0.02));
  mix-blend-mode: multiply; pointer-events:none;
}
/* small decorative rarity stripe at top for clarity */
.card .meta::after {
  content:""; display:block; height:4px; width:100%; border-radius:4px; margin-top:6px;
  background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(0,0,0,0.05));
  opacity:0.85;
}

.lang-toggle{
  background:transparent;border:1px solid var(--line);color:var(--text);padding:8px 10px;border-radius:10px;margin-bottom:8px;cursor:pointer;font-weight:700;
}
.lang-toggle:hover{transform:translateY(-1px)}

.debug-fab{position:fixed;right:22px;bottom:22px;width:56px;height:56px;border-radius:50%;border:1px solid var(--line);background:#121820;color:#fff;font-size:24px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,.35);transition:transform .12s ease,box-shadow .2s ease}
.debug-fab:hover{transform:translateY(-1px);box-shadow:0 12px 28px rgba(0,0,0,.45)}
.debug-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:50;backdrop-filter:saturate(120%) blur(2px)}
.debug-overlay.show{display:flex;animation:fadeIn .18s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.debug-panel{width:min(520px,92vw);background:var(--panel);border:1px solid var(--line);border-radius:14px;box-shadow:0 12px 40px rgba(0,0,0,.6);padding:16px 16px 18px}
.debug-title{font-weight:800;margin:4px 0 12px 0}
.passbox{display:flex;gap:8px;align-items:center;margin:8px 0 10px}
.pass-display{flex:1;background:#0e141c;border:1px solid #1b2230;border-radius:10px;padding:10px 12px;min-height:42px;font-weight:700;letter-spacing:.06em}
.pass-msg{font-size:12px;color:var(--muted);min-height:16px}
.keypad{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:8px}
.keypad button{background:#121820;border:1px solid #1f2630;color:#fff;padding:10px;border-radius:10px;cursor:pointer;font-size:18px}
.keypad button:active{transform:scale(.98)}
.hail{animation:shine .6s ease-in-out 3}
@keyframes shine{0%,100%{text-shadow:none}50%{text-shadow:0 0 12px rgba(255,255,255,.8)}}
.debug-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
.debug-field{background:#0e141c;border:1px solid #1b2230;border-radius:10px;padding:10px}
.debug-field label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
.debug-field input{width:100%;background:#0b1118;border:1px solid #1a2230;border-radius:8px;color:#fff;padding:8px}
.debug-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}
.debug-actions button{background:#121820;border:1px solid #2b7ab1;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}

.gallery-btn{background:transparent;border:1px solid var(--line);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:700}
.gallery-btn:hover{transform:translateY(-1px)}
.gallery-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:60}
.gallery-overlay.show{display:flex;animation:fadeIn .18s ease}
.gallery-panel{width:min(1200px,96vw);height:min(820px,92vh);background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:0 18px 60px rgba(0,0,0,.65);display:flex;flex-direction:column;overflow:hidden}
.gallery-topbar{display:flex;gap:8px;padding:10px;border-bottom:1px solid var(--line);background:#0e141c}
.gallery-tab{background:#121820;border:1px solid #1f2630;color:#fff;padding:8px 14px;border-radius:10px;cursor:pointer}
.gallery-tab.active{border-color:#2b7ab1}
.gallery-grid{padding:16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:14px;overflow:auto;flex:1}
.mini-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:70}
.mini-modal.show{display:flex;animation:fadeIn .16s ease}
.mini-panel{width:min(900px,92vw);height:min(700px,92vh);background:var(--panel);border:1px solid var(--line);border-radius:14px;box-shadow:0 12px 40px rgba(0,0,0,.6);padding:24px;overflow-y:auto;display:flex;flex-direction:column}
.mini-panel img {
  width: 100%;
  max-height: 400px;
  object-fit: contain;
  border-radius: 12px;
  margin-bottom: 16px;
}

.mcpass-fab{position:fixed;right:90px;bottom:22px;width:56px;height:56px;border-radius:50%;border:1px solid var(--line);background:#121820;color:#fff;font-size:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,.35);transition:transform .12s ease,box-shadow .2s ease}
.mcpass-fab:hover{transform:translateY(-1px);box-shadow:0 12px 28px rgba(0,0,0,.45)}
.mcpass-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:65}
.mcpass-overlay.show{display:flex;animation:fadeIn .18s ease}
.mcpass-panel{width:min(860px,94vw);background:var(--panel);border:1px solid var(--line);border-radius:14px;box-shadow:0 16px 50px rgba(0,0,0,.6);display:grid;grid-template-columns:1fr 1.2fr;gap:0;overflow:hidden;position:relative}
.mcpass-close{position:absolute;top:8px;right:8px;background:#121820;border:1px solid #1f2630;color:#fff;border-radius:10px;padding:6px 10px;cursor:pointer}
.mcpass-left{padding:18px;border-right:1px solid var(--line)}
.mcpass-right{padding:18px;display:flex;flex-direction:column;gap:12px}
.mcpass-title{font-weight:800;margin-bottom:8px}
.mcpass-dict{font-size:13px;line-height:1.6;color:var(--muted)}
.mcpass-question{font-family:"Space Mono","Noto Sans",monospace;background:#0e141c;border:1px solid #1b2230;border-radius:10px;padding:10px;color:#eaf2ff}
.mcpass-boxes{display:flex;gap:8px}
.mcpass-box{flex:1;background:#0e141c;border:1px solid #1b2230;border-radius:10px;height:48px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:20px}
.mcpass-box.ok{border-color:#2bb673;color:#2bb673}
.mcpass-box.err{border-color:#ef233c;color:#ef233c}
.mcpass-keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:6px}
.mcpass-key{background:#121820;border:1px solid #1f2630;color:#fff;padding:12px;border-radius:10px;font-size:18px;cursor:pointer}
.mcpass-key.wide{grid-column:2/3}

.battle-btn{margin-top:auto;background:transparent;border:1px solid var(--line);color:var(--text);padding:10px;border-radius:10px;cursor:pointer;font-weight:700}
.battle-btn:hover{transform:translateY(-1px)}
.b-overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;z-index:80}
.b-overlay.show{display:flex;animation:fadeIn .18s ease}
.b-panel{
  width:100vw;
  height:100vh;
  border-radius:0;
  max-width: none;
  max-height: none;
  background:var(--panel);border:1px solid var(--line);box-shadow:0 20px 60px rgba(0,0,0,.7);display:flex;flex-direction:column;overflow:hidden;position:relative;
}
.b-close{position:absolute;top:10px;right:10px;background:#121820;border:1px solid #1f2630;color:#fff;border-radius:10px;padding:6px 10px;cursor:pointer;z-index:2}
.b-top{display:flex;gap:8px;padding:10px;border-bottom:1px solid var(--line);background:#0e141c;align-items:center}
.b-title{font-weight:800}
.b-body{flex:1;display:grid;grid-template-columns:1fr 340px;gap:0;overflow:hidden}
.b-stage{position:relative;background:linear-gradient(180deg,#0e141c,#0a0d12);display:flex;align-items:flex-end;justify-content:space-between;padding:24px}
.b-palette{border-left:1px solid var(--line);display:flex;flex-direction:column;padding:14px;gap:10px;overflow:auto}
.pick-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.pick-card{background:#121820;border:1px solid #1f2630;border-radius:10px;padding:8px;display:flex;gap:8px;align-items:center;cursor:pointer}
.pick-card img{width:42px;height:42px;object-fit:contain;border-radius:8px}
.pick-card.sel{border-color:#2b7ab1;box-shadow:0 0 0 1px #2b7ab1 inset}
.team-row{display:flex;gap:8px;flex-wrap:wrap}
.badge{border:1px dashed #2b7ab1;border-radius:8px;padding:4px 8px;font-size:12px;color:#9bc9ff}
.start-btn{margin-top:6px;background:#121820;border:1px solid #2b7ab1;color:#fff;padding:10px;border-radius:10px;cursor:pointer}
.unit{position:relative;width:160px;height:220px;display:flex;flex-direction:column;align-items:center;justify-content:flex-end}
.unit img{max-width:140px;max-height:160px;object-fit:contain;filter:drop-shadow(0 8px 24px rgba(0,0,0,.6))}
.hpbar{position:absolute;top:8px;left:8px;right:8px;height:8px;background:#0b1118;border:1px solid #1b2230;border-radius:6px;overflow:hidden}
.hpbar .fill{height:100%;background:#2bb673;width:100%;transition:width .2s ease}
.u-name{position:absolute;top:20px;left:12px;font-size:12px;color:#cfe7ff}
.floater{position:absolute;color:#ef233c;font-weight:800;pointer-events:none;opacity:0;transform:translateY(0);transition:opacity .6s ease, transform .6s ease}
.action-wheel{position:absolute;bottom:190px;display:flex;gap:8px;background:#0e141c;border:1px solid #1b2230;border-radius:12px;padding:6px 8px}
.action-wheel button{background:#121820;border:1px solid #1f2630;color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer;font-size:12px}
.unit.bot-facing img.enemy{transform:scaleX(1)}
.unit.player-facing img.player{transform:scaleX(-1)}
.attacking{transition:transform .24s cubic-bezier(.2,.9,.2,1)}

.b-result{
  position:absolute;
  left:50%;
  top:48%;
  transform:translate(-50%,-50%) scale(.96);
  background:rgba(11,13,16,0.9);
  color:var(--text);
  padding:18px 28px;
  border-radius:12px;
  border:1px solid var(--line);
  font-weight:800;
  font-size:22px;
  opacity:0;
  transition:opacity .24s ease, transform .28s cubic-bezier(.2,.9,.2,1);
  z-index:6;
}
.b-result.show{ opacity:1; transform:translate(-50%,-50%) scale(1); }

.scpass-fab{position:fixed;right:158px;bottom:22px;width:56px;height:56px;border-radius:50%;border:1px solid var(--line);background:#121820;color:#fff;font-size:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,.35);transition:transform .12s ease,box-shadow .2s ease}
.scpass-fab:hover{transform:translateY(-1px);box-shadow:0 12px 28px rgba(0,0,0,.45)}
.scpass-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:66}
.scpass-overlay.show{display:flex;animation:fadeIn .18s ease}
.scpass-panel{width:min(900px,94vw);background:var(--panel);border:1px solid var(--line);border-radius:14px;box-shadow:0 16px 50px rgba(0,0,0,.6);display:grid;grid-template-columns:1.2fr 1fr;gap:0;overflow:hidden;position:relative;padding:16px}
.scpass-close{position:absolute;top:8px;right:8px;background:#121820;border:1px solid #1f2630;color:#fff;border-radius:10px;padding:6px 10px;cursor:pointer}
.sc-left{padding:8px 12px;border-right:1px solid var(--line)}
.sc-right{padding:8px 12px;display:flex;flex-direction:column;gap:10px}
.sc-title{font-weight:800;margin-bottom:6px}
.sc-progress{background:#0e141c;border:1px solid #1b2230;border-radius:10px;padding:10px;margin-bottom:10px;overflow:hidden}
.sc-bar{height:10px;background:#2bb673;border-radius:8px;width:0%;transition:width .08s linear, background .2s ease}
.sc-ptext{font-size:12px;color:var(--muted);margin-top:6px}
.sc-photo{width:100%;max-width:260px;aspect-ratio:1/1;object-fit:contain;border-radius:10px;border:1px solid #1b2230;background:#0e141c}
.sc-text{font-size:13px;color:#cfe7ff;margin:6px 0 10px}
.sc-labels{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
.sc-lab{background:#0e141c;border:1px solid #1b2230;border-radius:10px;padding:8px;text-align:center;font-weight:700}
.sc-lab.ok{border-color:#2bb673;color:#2bb673}
.sc-entry{display:flex;gap:8px}
.sc-box{flex:1;background:#0e141c;border:1px solid #1b2230;border-radius:10px;height:44px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:18px}
.sc-box.ok{border-color:#2bb673;color:#2bb673}
.sc-box.err{border-color:#ef233c;color:#ef233c}
.sc-pad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.sc-key{background:#121820;border:1px solid #1f2630;color:#fff;padding:12px;border-radius:10px;font-size:18px;cursor:pointer}
.sc-key:active{transform:scale(.98)}

.music-btn{background:transparent;border:1px solid var(--line);color:var(--text);padding:10px;border-radius:10px;cursor:pointer;font-weight:700}
.music-btn:hover{transform:translateY(-1px)}
.music-overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;z-index:70}
.music-overlay.show{display:flex;animation:fadeIn .18s ease}
.music-panel{width:min(1400px,96vw);height:min(900px,94vh);background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.7);display:flex;flex-direction:column;overflow:hidden;position:relative}
.music-close{position:absolute;top:10px;right:10px;background:#121820;border:1px solid #1f2630;color:#fff;border-radius:10px;padding:6px 10px;cursor:pointer;z-index:2}
.music-top{display:flex;align-items:center;gap:10px;padding:12px 14px;border-bottom:1px solid var(--line);background:#0e141c;font-weight:800}
.music-body{flex:1;overflow:auto;padding:16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(360px,1fr));gap:16px}
.music-card{background:#0e141c;border:1px solid #1b2230;border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px}
.music-title{font-weight:800}
.music-sub{color:var(--muted);font-size:12px}
.music-row{display:flex;flex-direction:column;gap:8px}
.music-row audio{width:100%}